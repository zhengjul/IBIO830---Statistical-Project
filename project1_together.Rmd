---
title: "Project1"
author: "Julia Zheng, Kate Skocelas"
date: "10/15/2020"
output:  
  html_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r input files, echo=FALSE}
#setwd("C:\\Dropbox\\Classes\\Classes\\IBIO 830 stats\\project1")
setwd("~/Desktop/stats/Project1/IBIO830---Statistical-Project")
butterfly_raw <- read.csv("Danaus.csv", header = TRUE)#,row.names=1)
str(butterfly_raw)
```

## Clean data for Section 1 plotting

```{r clean data for analysis 1, echo=TRUE}
#For section 1 plot, save only the necessary columns to a new dataframe and remove NA's
butterfly_data <- butterfly_raw
butterfly_data <- butterfly_data[!is.na(butterfly_data$latitude),]
butterfly_data <- butterfly_data[!is.na(butterfly_data$longitude),]
butterfly_data <- butterfly_data[!is.na(butterfly_data$scientific_name),]
butterfly_data <- butterfly_data[!is.na(butterfly_data$phyenotype..metamorphosis.stage.),]
butterfly_data <- butterfly_data[!is.na(butterfly_data$observed_on),]
# Rename column where there is a typo 
names(butterfly_data)[names(butterfly_data) == "phyenotype..metamorphosis.stage."] <- "metamorphosis_stage"

```

## SECTION 1: Species distribution across the world
### Adding colours qualitatively with a library
```{r load libraries, message=FALSE}
if (!require(RColorBrewer)) install.packages('RColorBrewer')
library(RColorBrewer)
if (!require(rworldmap)) install.packages('rworldmap')
library(rworldmap)
if (!require(scales)) install.packages('scales')
library(scales)
```

```{r}
butterfly_data$scientific_name <- as.factor(butterfly_data$scientific_name)
jColors <- with(butterfly_data,
                data.frame(scientific_name = levels(scientific_name),
                           color = I(brewer.pal(nlevels(scientific_name), name = 'Accent'))))

butterfly_data_scatter <- data.frame(subset(butterfly_data, select = c(latitude, longitude, scientific_name)),
           matchRetVal = match(butterfly_data$scientific_name, jColors$scientific_name))
```

### Plot points onto world map
```{r fig.width=14, fig.height=9}

plot(getMap(), 
     xlab = "Longitude",     
     ylab = "Latitude",     
     main = 'Genus Danaus (Tiger MilkWeed Butterfly) Observed Across the World')

points(butterfly_data_scatter$longitude, butterfly_data_scatter$latitude, 
       col=alpha(jColors$color[match(butterfly_data_scatter$scientific_name, jColors$scientific_name)],0.4), 
       pch=19,cex=1.3)

legend("bottom", inset=c(0,0), 
       legend = as.character(jColors$scientific_name),
       col = jColors$color, pch = 19, cex=0.7,
       xpd=TRUE, horiz=T)
```

The pdf figure looks like there is a concentration of observations from the US, in particular species Danaus plexippus. 
Additionally, there is a lack thereof from the Eastern continents in the world. 
Even with this great disparity in available data, we can still observe differences in Danaus species (visual colour differences) spread across the globe.

## SECTION 2: statistical chi-squared goodness of fit 
Testing the Chi-squared goodness of fit on our categorical data describing the 4 metamorphic stage of genus Danaus butterflies.

From the following link, I learned about average duration of butterflies' metamorphic stages. 
#https://www.joyfulbutterfly.com/life-cycle-of-a-butterfly/

I make the assumption that the following information applies for genus Danaus across the world, time, and region.
<pre>
# butterfly life cycle

Egg:               5 days                              5/57.5 = 0.08695652

Caterpillar:       3.5 weeks = 24.5 days               24.5/57.5 = 0.426087

Chrysalis/Pupa:    1.5 weeks = 10.5 days               10.5/57.5 = 0.1826087

Adult butterfly:   2.5 weeks = 17.5 days               17.5/57.5 = 0.3043478

Total lifecycle:   5+24.5+10.5+17.5 = 57.5 days
</pre>
```{r}
chisq.test(table(butterfly_data$metamorphosis_stage), p = c(5, 24.5, 10.5, 17.5)/57.5)

```
Based on the chi-square goodness of fit test, our p-value 2.2e-16 < 0.005, meaning this test strongly rejects the null hypothesis of no fit.
Thus, I conclude that our observed dataset for genus Danaus matches with the provided, predicted average butterfly lifecycle durations.

