---
title: "Tiger Milkweed Butterflies (genus Danaus) Statistical Project"
author: "Julia Zheng & Kate Skocelas"
date: "10/15/2020"
output:  
  html_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Read in raw data
```{r input files}
#setwd("C:\\Dropbox\\Classes\\Classes\\IBIO 830 stats\\project1")
setwd("~/Desktop/stats/Project1/IBIO830---Statistical-Project")

# load raw data from csv file
butterfly_raw <- read.csv("Danaus.csv", header = TRUE)
```

### Load required libraries
```{r load libraries, message=FALSE}
if (!require(RColorBrewer)) install.packages('RColorBrewer')
library(RColorBrewer)

if (!require(rworldmap)) install.packages('rworldmap')
library(rworldmap)

if (!require(scales)) install.packages('scales')
library(scales)

if (!require(dplyr)) install.packages('dplyr')
library(dplyr)

if (!require(ggplot2)) install.packages('ggplot2')
library(ggplot2)
```


## Data cleaning and exploration

```{r clean data, echo=TRUE}

# Rename column where there is a typo 
names(butterfly_raw)[names(butterfly_raw) == "phyenotype..metamorphosis.stage."] <- "metamorphosis_stage"

# check for NAs in the data
sum(is.na(butterfly_raw)) # 132 NAs found 

# Remove NAs in the data columns we are looking at
butterfly_data <- butterfly_raw
butterfly_data <- butterfly_data[!is.na(butterfly_data$latitude),]
butterfly_data <- butterfly_data[!is.na(butterfly_data$longitude),]
butterfly_data <- butterfly_data[!is.na(butterfly_data$positional_accuracy),]
butterfly_data <- butterfly_data[!is.na(butterfly_data$scientific_name),]
butterfly_data <- butterfly_data[!is.na(butterfly_data$metamorphosis_stage),]
butterfly_data <- butterfly_data[!is.na(butterfly_data$observed_on),]
```

## Initial plotting
```{r look at structure}
# look at the structure of the data frame
str(butterfly_raw)
head(butterfly_raw)
```

### Metamorphic stage of samples
```{r plot metamorphic stage}
# Create bar plot of metamorphic stage
ggplot(butterfly_data, aes(x=metamorphosis_stage))+
  geom_bar(col="black", fill= c("turquoise2", "darkorchid4", "orange2", "red"))+
  labs(x="Metamorphic Stage", y="Number of Samples", title="Metamorphic Stage of Samples")+
  theme_classic()
```

There are significantly more samples of organisms in the "butterfly" metamorphic stage than in any of the other metamorphic stages. This may represent a sampling bias in the dataset. Individuals in the "butterfly" stage may be easier for amatuer naturalists to spot or more appealing to photograph and log. In the statistical tests section, we use a chi-squared goodnesss of fit test to test the null hypothesis that our data set does not accurately represent the expected average lifecyle durations of genus Danaus butterflies.
#FIXME Julia - does this paragraph look correct to you? Please make any changes you feel are needed.

### Metamorphic stage of sample compared to observation date
```{r metamorphic stage vs date observed}

#plot stage against date of observation
butterfly_data$month <- substr(butterfly_data$observed_on, 1,2)
for(i in 1:nrow(butterfly_data)) {
  month <- butterfly_data$month[i]
  last_letter <- substr(month, 2,2)
  if(last_letter == "/") {
    month <- substr(month, 1,1)
  }
  butterfly_data$month[i] <- month
}

phenotype <- butterfly_data$metamorphosis_stage
butterfly_data$month <- factor(butterfly_data$month, levels=c("1","2","3","4","5","6","7","8","9","10","11","12"))

ggplot(butterfly_data, aes(x=month, fill=phenotype))+
  geom_bar()+
  labs(x="Month", y="Number of Samples", title="Metamorphic Stage of Samples by Month Observed")+
  theme_classic()
```

#FIXME Kate/Julia what to say about this plot? What does it tell us?

### Positional accuracy vs. latitude and longitude
```{r plot positional accuracy vs lat & long, fig.width=14, fig.height=7}

par(mfrow=c(1,2))

plot(butterfly_data$positional_accuracy ~butterfly_data$latitude, 
     xlab = "Latitude", 
     ylab = "Positional Accuracy", 
     pch = 19, 
     col = adjustcolor(1,0.4),
     main = "Positional Accuracy vs Latitude")

plot(butterfly_data$positional_accuracy ~butterfly_data$longitude, 
     xlab = "Longitude", 
     ylab = "Positional Accuracy", 
     pch = 19, 
     col = adjustcolor(1,0.4),
     main = "Positional Accuracy vs Longitude")

```

There are few outliers we have to remove. We do that and replot the data.
#FIXME Julia - Should say why we need to remove the outliers here? 

```{r plot positional accuracy vs lat & long w/o outliers, fig.width=14, fig.height=7}

# remove outliers
butterfly_data <- butterfly_data %>% filter(positional_accuracy < 15000)

par(mfrow=c(1,2))

plot(butterfly_data$positional_accuracy ~butterfly_data$latitude, 
     xlab = "Latitude", 
     ylab = "Positional Accuracy", 
     pch = 19, 
     col = adjustcolor(1,0.4),
     main = "Positional accuracy vs Latitude")

plot(butterfly_data$positional_accuracy ~butterfly_data$longitude, 
     xlab = "Longitude", 
     ylab = "Positional Accuracy", 
     pch = 19, 
     col = adjustcolor(1,0.4),
     main = "Positional accuracy vs Longitude")
```

#FIXME Julia - I think we need to say what these corrected plots tell us, but I'm not sure what they tell us?


### Species distribution across the world

#### Adding colours qualitatively with a library
```{r add colours qualitatively}
butterfly_data$scientific_name <- as.factor(butterfly_data$scientific_name)
jColors <- with(butterfly_data,
                data.frame(scientific_name = levels(scientific_name),
                           color = I(brewer.pal(nlevels(scientific_name), name = 'Accent'))))

butterfly_data_scatter <- data.frame(subset(butterfly_data, select = c(latitude, longitude, scientific_name)),
           matchRetVal = match(butterfly_data$scientific_name, jColors$scientific_name))
```

#### Plot points onto world map
```{r plot points onto world map, fig.width=14, fig.height=9}

plot(getMap(), 
     xlab = "Longitude",     
     ylab = "Latitude",     
     main = 'Genus Danaus (Tiger MilkWeed Butterfly) Observed Across the World')

points(butterfly_data_scatter$longitude, butterfly_data_scatter$latitude, 
       col=alpha(jColors$color[match(butterfly_data_scatter$scientific_name, jColors$scientific_name)],0.4), 
       pch=19,cex=1.3)

legend("bottom", inset=c(0,0), 
       legend = as.character(jColors$scientific_name),
       col = jColors$color, pch = 19, cex=0.7,
       xpd=TRUE, horiz=T)
```

There is a concentration of observations from the USA, in particular species Danaus plexippus. 
Additionally, there is a lack thereof from the eastern continents in the world. 
Even with this great disparity in available data, we can still observe differences in Danaus species (visual colour differences) spread across the globe.

## Statistical tests
### Chi-squared goodness of fit test
We conducted a Chi-squared goodness of fit on our categorical data describing the 4 metamorphic stage of genus Danaus butterflies.

From the following link, I learned about average duration of butterflies' metamorphic stages. 
#https://www.joyfulbutterfly.com/life-cycle-of-a-butterfly/

I make the assumption that the following information applies for genus Danaus across the world, time, and region.
<pre>
# butterfly life cycle

Egg:               5 days                              5/57.5 = 0.08695652

Caterpillar:       3.5 weeks = 24.5 days               24.5/57.5 = 0.426087

Chrysalis/Pupa:    1.5 weeks = 10.5 days               10.5/57.5 = 0.1826087

Adult butterfly:   2.5 weeks = 17.5 days               17.5/57.5 = 0.3043478

Total lifecycle:   5+24.5+10.5+17.5 = 57.5 days
</pre>
```{r chi-squared test}
chisq.test(table(butterfly_data$metamorphosis_stage), p = c(5, 24.5, 10.5, 17.5)/57.5)
```
Based on the chi-square goodness of fit test, our p-value 2.2e-16 < 0.005, meaning this test strongly rejects the null hypothesis of no fit.
Thus, I conclude that our observed dataset for genus Danaus matches with the provided, predicted average butterfly lifecycle durations.

### Kate's Statistical Test
#FIXME Kate - figure out what would make sense & do it.

## Summary of Results
#FIXME Kate/Julia fill in 

